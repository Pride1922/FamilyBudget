<div class="app-container">
  <div class="password-reset-container mat-elevation-z2">
    <!-- Token Error Message -->
    <div *ngIf="!isValidToken && errorMessage" class="error-message mat-body-2">{{ errorMessage }}</div>

    <!-- Password Reset Form -->
    <form *ngIf="isValidToken" [formGroup]="passwordResetForm" (ngSubmit)="resetPassword()">
      <!-- New Password Field -->
      <mat-form-field appearance="fill">
        <mat-label>New Password</mat-label>
        <input matInput formControlName="newPassword" [type]="hidePassword ? 'password' : 'text'" required>
        <mat-error *ngIf="passwordResetForm.get('newPassword')?.hasError('required') && (passwordResetForm.get('newPassword')?.touched || passwordResetForm.get('newPassword')?.dirty)">
          New Password is required.
        </mat-error>
        <mat-error *ngIf="passwordResetForm.get('newPassword')?.hasError('minlength') && (passwordResetForm.get('newPassword')?.touched || passwordResetForm.get('newPassword')?.dirty)">
          Password must be at least 6 characters long.
        </mat-error>
        <mat-error *ngIf="passwordResetForm.get('newPassword')?.hasError('maxlength') && (passwordResetForm.get('newPassword')?.touched || passwordResetForm.get('newPassword')?.dirty)">
          Password cannot exceed 20 characters.
        </mat-error>
        <button mat-icon-button type="button" (click)="togglePasswordVisibility('newPassword')" matSuffix>
          <mat-icon>{{ hidePassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
      </mat-form-field>

      <!-- Confirm Password Field -->
      <mat-form-field appearance="fill">
        <mat-label>Confirm Password</mat-label>
        <input matInput formControlName="confirmPassword" [type]="hideConfirmPassword ? 'password' : 'text'" required>
        <mat-error *ngIf="passwordResetForm.get('confirmPassword')?.hasError('required') && (passwordResetForm.get('confirmPassword')?.touched || passwordResetForm.get('confirmPassword')?.dirty)">
          Confirm Password is required.
        </mat-error>
        <mat-error *ngIf="passwordResetForm.get('confirmPassword')?.hasError('mismatch') && (passwordResetForm.get('confirmPassword')?.touched || passwordResetForm.get('confirmPassword')?.dirty)">
          Passwords do not match.
        </mat-error>
        <button mat-icon-button type="button" (click)="togglePasswordVisibility('confirmPassword')" matSuffix>
          <mat-icon>{{ hideConfirmPassword ? 'visibility_off' : 'visibility' }}</mat-icon>
        </button>
      </mat-form-field>

      <!-- Reset Password Button -->
      <button mat-raised-button color="primary" type="submit" class="full-width" [disabled]="isLoading">
        Reset Password
      </button>

      <!-- Spinner -->
      <mat-spinner *ngIf="isLoading" class="spinner"></mat-spinner>
    </form>
  </div>
</div>
